<!DOCTYPE html>
<html>
<head>
    <title>Word Hunt</title>
    <script src="shared.js"></script>
    <style>
        .grid { display: grid; grid-template-columns: repeat(5, 40px); gap: 2px; margin: 10px 0; }
        .cell { width: 40px; height: 40px; border: 1px solid #000; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .selected { background-color: lightblue; }
        .found { background-color: lightgreen; }
    </style>
</head>
<body>
    <h1>Word Hunt</h1>
    <div id="game-container"></div>
    
    <script>
        const wordSets = [
            {
                words: ['cat', 'dog', 'fish'],
                grid: [
                    ['c', 'a', 't', 'x', 'y'],
                    ['d', 'o', 'g', 'z', 'w'],
                    ['f', 'i', 's', 'h', 'v'],
                    ['q', 'r', 'u', 'b', 'm'],
                    ['p', 'l', 'k', 'j', 'e']
                ]
            },
            {
                words: ['sun', 'moon', 'star'],
                grid: [
                    ['s', 'u', 'n', 'x', 'y'],
                    ['a', 'm', 'o', 'o', 'n'],
                    ['s', 't', 'a', 'r', 'z'],
                    ['b', 'c', 'd', 'e', 'f'],
                    ['g', 'h', 'i', 'j', 'k']
                ]
            }
        ];
        
        let currentGame;
        let foundWords = [];
        let selectedCells = [];
        let startTime;
        
        function newGame() {
            currentGame = wordSets[Math.floor(Math.random() * wordSets.length)];
            foundWords = [];
            selectedCells = [];
            startTime = Date.now();
            renderGame();
        }
        
        function renderGame() {
            let html = `
                <p>Find these words: ${currentGame.words.join(', ')}</p>
                <div class="grid" id="letter-grid">
            `;
            
            currentGame.grid.forEach((row, rowIndex) => {
                row.forEach((letter, colIndex) => {
                    const isFound = foundWords.some(word => 
                        word.cells.some(cell => cell.row === rowIndex && cell.col === colIndex)
                    );
                    const isSelected = selectedCells.some(cell => cell.row === rowIndex && cell.col === colIndex);
                    
                    html += `<div class="cell ${isFound ? 'found' : ''} ${isSelected ? 'selected' : ''}" 
                                data-row="${rowIndex}" data-col="${colIndex}"
                                onclick="selectCell(this, ${rowIndex}, ${colIndex})">
                                ${letter}
                            </div>`;
                });
            });
            
            html += `</div>
                <p>Selected letters: <span id="selected-letters">${getSelectedLetters()}</span></p>
                <button onclick="checkWord()">Check Word</button>
                <p id="result"></p>
                <p>Found words: ${foundWords.map(w => w.word).join(', ') || 'None'}</p>
            `;
            
            document.getElementById('game-container').innerHTML = html;
        }
        
        function selectCell(element, row, col) {
            // If no cells selected yet, just select this one
            if (selectedCells.length === 0) {
                selectedCells.push({ row, col, letter: element.textContent });
                element.classList.add('selected');
                updateSelectedLetters();
                return;
            }
            
            // Check if this cell is adjacent to the last selected cell
            const lastCell = selectedCells[selectedCells.length - 1];
            const rowDiff = Math.abs(row - lastCell.row);
            const colDiff = Math.abs(col - lastCell.col);
            
            if (rowDiff <= 1 && colDiff <= 1 && !(rowDiff === 0 && colDiff === 0)) {
                // Check if already selected (to allow unselecting)
                const index = selectedCells.findIndex(c => c.row === row && c.col === col);
                if (index >= 0) {
                    selectedCells.splice(index, 1);
                    element.classList.remove('selected');
                } else {
                    selectedCells.push({ row, col, letter: element.textContent });
                    element.classList.add('selected');
                }
                updateSelectedLetters();
            } else {
                alert('Please select adjacent letters!');
            }
        }
        
        function getSelectedLetters() {
            return selectedCells.map(c => c.letter).join('');
        }
        
        function updateSelectedLetters() {
            const display = document.getElementById('selected-letters');
            if (display) display.textContent = getSelectedLetters();
        }
        
        function checkWord() {
            if (selectedCells.length === 0) {
                document.getElementById('result').textContent = 'Please select some letters first!';
                return;
            }
            
            const word = getSelectedLetters().toLowerCase();
            const isWord = currentGame.words.includes(word);
            const alreadyFound = foundWords.some(w => w.word === word);
            
            if (isWord && !alreadyFound) {
                foundWords.push({
                    word,
                    cells: [...selectedCells]
                });
                document.getElementById('result').textContent = `✅ Found "${word}"!`;
                
                // Clear selection
                selectedCells = [];
                updateSelectedLetters();
                
                if (foundWords.length === currentGame.words.length) {
                    const timeSpent = (Date.now() - startTime) / 1000;
                    const score = Math.max(10, 500 - Math.floor(timeSpent));
                    
                    saveGameResult('game3', {
                        isCorrect: true,
                        score,
                        timeSpent,
                        words: currentGame.words,
                        foundWords: foundWords.map(w => w.word),
                        grid: currentGame.grid
                    });
                    
                    setTimeout(newGame, 2000);
                }
            } else if (alreadyFound) {
                document.getElementById('result').textContent = `⚠️ You already found "${word}"`;
            } else {
                document.getElementById('result').textContent = `❌ "${word}" is not in the list`;
            }
            
            renderGame();
        }
        
        window.onload = newGame;
    </script>
</body>
</html>
